import{d as Z,x as h,k as Q,y as A,h as n,c as i,F as $,r as X,a0 as J,t as q,_ as ce,i as le,M as we,a7 as ke,E as Ce,a8 as Se,a9 as $e,G as Ee,o as de,J as Re,a as t,m as B,b as _,q as c,z as j,aa as se,f as Y,e as x,ab as oe,w as G,X as Le,O as ne,U as ie,p as Ie,j as Ne,V as Te,u as Ae,l as Fe,$ as Pe}from"./index-8a67cbc7.js";import{A as y,e as Ve,S as T,_ as qe}from"./MapClient.vue_vue_type_script_setup_true_lang-8cc5b589.js";import{E as ue,L as re}from"./LoadingMessage-3409ceb1.js";import{B as Oe}from"./BaseModal-3ad8610c.js";function De(b,u,d,f,w,k){let s;if(u.length==0)s="";else if(u.length==1){const r=u[0];s=`POINT (${r[0]} ${r[1]})`}else s=`POLYGON ((${u.map(r=>`${r[0]} ${r[1]}`).join(", ")}))`;let v="";switch(d){case y.Contains:v=`FILTER (geof:sfContains("${s}"^^geo:wktLiteral, ?wkt))`;break;case y.Within:v=`FILTER (geof:sfWithin("${s}"^^geo:wktLiteral, ?wkt))`;break;case y.Nearby:v=`FILTER (spatialF:nearby("${s}"^^geo:wktLiteral, ?wkt, ${f}, unit:kilometre))`;break;case y.Overlaps:v=`FILTER (geof:sfOverlaps("${s}"^^geo:wktLiteral, ?wkt))`;break;default:v=""}return`PREFIX geo: <http://www.opengis.net/ont/geosparql#>
    PREFIX geof: <http://www.opengis.net/def/function/geosparql/>
    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
    PREFIX spatialF: <http://jena.apache.org/function/spatial#>
    PREFIX unit: <http://www.opengis.net/def/uom/OGC/1.0/>
    SELECT ?f_uri ?wkt ?fc ?fc_label ?f_label
    WHERE {
        ?f_uri geo:hasGeometry/geo:asWKT ?wkt .
        
        ${b.map(r=>`{
                <${r}> rdfs:member ?f_uri ;
                    <${k.props.fcLabel}> ?fc_label .
                BIND (<${r}> AS ?fc)
            }`).join(" UNION ")}

        OPTIONAL {
            ?f_uri <${k.props.fLabel}> ?f_label .
        }

        ${v}
    }
    LIMIT ${w}`}const Me={class:"button-container"},xe=["onClick","disabled"],Be=Z({__name:"ButtonGroup",props:{buttons:{type:Array,required:!0},allowMultipleSelection:{type:Boolean,default:!1},initialValue:{type:String,default:null},disabled:{type:Boolean,default:!1}},emits:["change"],setup(b,{emit:u}){const d=b,f=h([]);function w(s){d.allowMultipleSelection?f.value.includes(s)?f.value=f.value.filter(r=>r!==s):f.value.push(s):f.value=[s],u("change",k.value)}const k=Q(()=>f.value.map(s=>d.buttons[s].value));if(d.initialValue){const s=d.buttons.findIndex(v=>v.value===d.initialValue);s>=0&&f.value.push(s)}return A(()=>d.initialValue,(s,v)=>{if(s=="")return;const r=d.buttons.findIndex(R=>R.value==s),E=r>=0?d.buttons[r]:"";if(s!==v||s!=E){const R=d.buttons.findIndex(O=>O.value===s);R>=0&&(f.value=[R])}}),(s,v)=>(n(),i("div",Me,[(n(!0),i($,null,X(b.buttons,(r,E)=>(n(),i("button",{key:E,onClick:R=>w(E),class:J(["btn sm",{outline:!f.value.includes(E)}]),disabled:d.disabled},q(r.text),11,xe))),128))]))}});const Ge=ce(Be,[["__scopeId","data-v-274e2d88"]]),g=b=>(Ie("data-v-d2ef0615"),b=b(),Ne(),b),Ue={class:"spatial-search"},ze={class:"search-options"},je={class:"search-form-container"},Qe={class:"search-form"},Xe={class:"form-section"},He=g(()=>t("h4",null,"Map Selection",-1)),Ke={key:0,style:{"padding-top":"10px","font-size":"0.7em"}},We={class:"form-section"},Ye=g(()=>t("h4",null,"Datasets & Feature Collections",-1)),Je={class:"dataset-buttons"},Ze={class:"select-all-input"},et=["checked"],tt=g(()=>t("label",{for:"select-all"},"Select all",-1)),at=g(()=>t("i",{class:"fa-regular fa-chevron-down"},null,-1)),lt=g(()=>t("i",{class:"fa-regular fa-chevron-up"},null,-1)),st={key:2,class:"dataset-options"},ot={class:"dataset-option"},nt=["id","value","onChange"],it=["for"],ut=["onClick"],rt={class:"fc-option"},ct=["id","value"],dt=["for"],pt={class:"bottom-buttons"},ft=g(()=>t("i",{class:"fa-regular fa-code"},null,-1)),vt={class:"right-buttons"},_t={class:"result-limit-input"},ht=g(()=>t("label",{for:"result-limit"},"Result limit",-1)),mt=["disabled"],gt=g(()=>t("i",{class:"fa-regular fa-magnifying-glass"},null,-1)),bt={class:"search-map"},yt={class:"results"},wt=g(()=>t("h3",null,"Results",-1)),kt={key:2},Ct=g(()=>t("thead",null,[t("tr",null,[t("th",null,"Title"),t("th",null,"Feature Collection")])],-1)),St=["href"],$t={key:3},Et={class:"sparql-query-content"},Rt=g(()=>t("i",{class:"fa-regular fa-copy"},null,-1)),Lt=Z({__name:"SpacePrezSearchMap",setup(b){const{namedNode:u}=Te,d=le(we),f=le(ke),{loading:w,error:k,apiGetRequest:s}=Ce(),{loading:v,hasError:r,concurrentApiRequests:E}=Se(),{loading:R,error:O,sparqlGetRequest:pe}=$e(),{store:F,parseIntoStore:ee,qnameToIri:P}=Ee(),fe=Ve(y),D=h([]),V=h([]),m=h([]),C=h({type:T.None,coords:[]}),L=h(y.Nearby),H=h(!1),U=h(10),z=h(5),M=h([]),S=h({}),K=h(null),te=Q(()=>Object.values(S.value).every(a=>a)),ae=Q(()=>{let a=!0;return D.value.forEach(e=>{if(V.value.includes(e.iri)){if(!e.featureCollections.every(l=>m.value.includes(l.iri)))return a=!1,!1}else return a=!1,!1}),a}),W=Q(()=>De(m.value,C.value.coords,L.value,z.value,U.value,f.search));function ve(){let a=[],e=[];ae.value||D.value.forEach(l=>{a.push(l.iri),e=[...e,...l.featureCollections.map(o=>o.iri)]}),V.value=a,m.value=e}function _e(a,e){e?a.featureCollections.forEach(l=>{m.value.includes(l.iri)||m.value.push(l.iri)}):a.featureCollections.forEach(l=>{const o=m.value.indexOf(l.iri);o>=0&&m.value.splice(o,1)})}function he(){let a={};Object.keys(S.value).forEach(e=>a[e]=!te.value),S.value=a}function me(a){L.value=a[0]}function ge(a,e){C.value={type:e,coords:a},e!=T.None&&(e==T.Point?L.value=y.Nearby:L.value=y.Contains)}async function be(){const{data:a}=await s("/s/datasets");if(a&&!k.value){ee(a);const e={};F.value.forSubjects(o=>{const p={iri:o.value,link:"",featureCollections:[]};p.title=ne(o.value,F.value),F.value.forObjects(N=>{p.link=N.value},o,u(P("prez:link")),null),e[o.value]=p},u(P("a")),u(P("dcat:Dataset")),null),(await E(Object.values(e).map(o=>`${o.link}/collections`))).forEach(o=>{o.value&&ee(o.value)}),F.value.forSubjects(o=>{F.value.forObjects(p=>{const N={iri:p.value};N.title=ne(p.value,F.value),e[o.value].featureCollections.push(N)},o,u(P("rdfs:member")),null),e[o.value].featureCollections.sort(ie)},u(P("a")),u(P("dcat:Dataset")),null),D.value=Object.values(e).sort(ie)}}async function I(){if(C.value.coords.length>0){const a=await pe(`${d}/sparql`,W.value);a&&!O.value&&(M.value=a.results.bindings.map(e=>({uri:e.f_uri.value,link:`/object?uri=${encodeURIComponent(e.f_uri.value)}`,wkt:e.wkt.value,fcLabel:e.fc_label?e.fc_label.value:"",label:e.f_label?e.f_label.value:""})),K.value&&K.value.drawShape(M.value))}}return A(V,async(a,e)=>{await I()},{deep:!0}),A(m,async(a,e)=>{await I()},{deep:!0}),A(U,async(a,e)=>{await I()}),A(z,async(a,e)=>{await I()}),A(C,async(a,e)=>{await I()},{deep:!0}),A(L,async(a,e)=>{await I()}),de(async()=>{await Re(),await be(),D.value.forEach(a=>{S.value[a.iri]=!0,V.value.push(a.iri),a.featureCollections.forEach(e=>{m.value.push(e.iri)})})}),(a,e)=>(n(),i($,null,[t("div",Ue,[t("div",ze,[t("div",je,[t("div",Qe,[t("div",Xe,[He,B(Ge,{"initial-value":C.value.type!==_(T).None?L.value:void 0,onChange:me,buttons:_(fe),allowMultipleSelection:!1,disabled:C.value.type===_(T).None},null,8,["initial-value","buttons","disabled"]),C.value.type!==_(T).None&&L.value==_(y).Nearby?(n(),i("div",Ke,[c(" within "),j(t("input",{type:"number",class:"radius-input","onUpdate:modelValue":e[0]||(e[0]=l=>z.value=l),min:"1",max:"10000"},null,512),[[se,z.value]]),c(" km ")])):Y("",!0)]),t("div",We,[Ye,t("div",Je,[t("div",Ze,[t("input",{type:"checkbox",name:"select-all",id:"select-all",onChange:ve,checked:ae.value},null,40,et),tt]),t("button",{class:"btn outline sm",onClick:he,title:"Toggle collapse all datasets"},[te.value?(n(),i($,{key:0},[c("Expand all "),at],64)):(n(),i($,{key:1},[c("Collapse all "),lt],64))])]),_(w)||_(v)?(n(),x(re,{key:0})):_(k)?(n(),x(ue,{key:1,message:`Unable to load datasets: ${_(k)}`},null,8,["message"])):(n(),i("ul",st,[(n(!0),i($,null,X(D.value,(l,o)=>(n(),i("li",ot,[j(t("input",{type:"checkbox",id:`dataset-${o}`,value:l.iri,"onUpdate:modelValue":e[1]||(e[1]=p=>V.value=p),onChange:p=>_e(l,p.target?.checked)},null,40,nt),[[oe,V.value]]),t("label",{for:`dataset-${o}`},q(l.title||l.iri),9,it),t("button",{class:"btn outline sm dataset-collapse-btn",onClick:p=>S.value[l.iri]=!S.value[l.iri],title:"Toggle collapse this dataset"},[t("i",{class:J(`fa-regular fa-chevron-${S.value[l.iri]?"down":"up"}`)},null,2)],8,ut),l.featureCollections.length>0?(n(),i("ul",{key:0,class:J(`fc-options ${S.value[l.iri]?"collapse":""}`)},[(n(!0),i($,null,X(l.featureCollections,(p,N)=>(n(),i("li",rt,[j(t("input",{type:"checkbox",id:`fc-${o}-${N}`,value:p.iri,"onUpdate:modelValue":e[2]||(e[2]=ye=>m.value=ye)},null,8,ct),[[oe,m.value]]),t("label",{for:`fc-${o}-${N}`},q(p.title||p.iri),9,dt)]))),256))],2)):Y("",!0)]))),256))]))])]),t("div",pt,[t("button",{class:"btn outline",onClick:e[3]||(e[3]=l=>H.value=!0)},[c("Show Query "),ft]),t("div",vt,[t("div",_t,[ht,j(t("input",{id:"result-limit",type:"number","onUpdate:modelValue":e[4]||(e[4]=l=>U.value=l),min:"1",max:"100"},null,512),[[se,U.value]])]),t("button",{class:"btn",onClick:e[5]||(e[5]=l=>I()),disabled:C.value.type==_(T).None},[c("Search "),gt],8,mt)])])]),t("div",bt,[B(qe,{ref_key:"searchMap",ref:K,"geo-w-k-t":M.value,"drawing-modes":["MARKER","POLYGON","RECTANGLE"],onSelectionUpdated:ge},null,8,["geo-w-k-t"])])]),t("div",yt,[wt,_(R)?(n(),x(re,{key:0})):_(O)?(n(),x(ue,{key:1,message:_(O)},null,8,["message"])):M.value.length>0?(n(),i("table",kt,[Ct,t("tbody",null,[(n(!0),i($,null,X(M.value,l=>(n(),i("tr",null,[t("td",null,[t("a",{href:l.link},q(l.label||l.uri),9,St)]),t("td",null,q(l.fcLabel),1)]))),256))])])):(n(),i("div",$t," No results "))])]),H.value?(n(),x(Oe,{key:0,onModalClosed:e[7]||(e[7]=l=>H.value=!1)},{headerMiddle:G(()=>[c("Spatial Search SPARQL Query")]),footer:G(()=>[t("button",{class:"btn outline sparql-copy-btn",onClick:e[6]||(e[6]=l=>_(Le)(W.value)),title:"Copy SPARQL query"},[c("Copy "),Rt])]),default:G(()=>[t("div",Et,[t("pre",null,q(W.value.trim()),1)])]),_:1})):Y("",!0)],64))}});const It=ce(Lt,[["__scopeId","data-v-d2ef0615"]]),Nt=t("h1",{class:"page-title"},"Spatial Data Catalog",-1),Tt=t("a",{href:"https://www.w3.org/TR/vocab-dcat-2/"},"DCAT",-1),At=t("a",{href:"https://www.ogc.org/standard/geosparql/"},"GeoSPARQL",-1),Ot=Z({__name:"SpacePrezHomeView",setup(b){const u=Ae();return de(()=>{u.rightNavConfig={enabled:!1},document.title="Spatial Data Catalog Home | Prez",u.pageHeading={name:"SpacePrez",url:"/s"},u.breadcrumbs=[{name:Fe("SpacePrez")+" Home",url:"/s"}]}),(d,f)=>{const w=Pe("RouterLink");return n(),i($,null,[Nt,t("p",null,[c(" A spatial catalog of Feature Collections and Features conforming to "),Tt,c(" and "),At,c(", and delivered as a read-only web system in both human and machine-readable views. The views are known as profiles and a list of them are available "),B(w,{to:"/s/profiles"},{default:G(()=>[c("here")]),_:1}),c(". ")]),t("p",null,[c(" The system provides a set of RDF APIs and also an OGC API for Feature Collections and Features. See the "),B(w,{to:"/docs"},{default:G(()=>[c("API Documentation")]),_:1}),c(" for more information. ")]),B(It)],64)}}});export{Ot as default};
