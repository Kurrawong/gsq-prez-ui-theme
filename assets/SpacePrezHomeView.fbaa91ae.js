import{a1 as ae,i as z,a2 as J,a3 as me,D as _e,a4 as be,a0 as se,B as le,d as H,x as p,k as O,y as ge,h as c,c as d,F as $,r as A,G,t as E,_ as oe,o as ne,a as e,m as x,b as u,q as h,z as T,E as Z,f as V,C as q,a5 as ye,e as P,w as F,p as Ce,j as Se,u as we,l as ke,O as $e}from"./index.cba3b563.js";import{c as ie,S as R,A as k,e as je,_ as Re,m as De}from"./MapClient.vue_vue_type_script_setup_true_lang.4fbcc6d6.js";import{a as re,B as Ee}from"./BaseModal.fc5de8eb.js";import{c as Me}from"./helpers.6a12a23c.js";import{E as ee,L as te}from"./LoadingMessage.4d3be192.js";const{namedNode:D}=_e,Te=t=>`PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX prez: <https://prez.dev/>

CONSTRUCT {?ds a <${t.spatial.datasetClass}> ;
    <${t.props.dsLabel}> ?ds_title ;
    <${t.spatial.membershipRelationship}> ?fc .
  ?fc a geo:FeatureCollection ;
  <${t.props.fcLabel}> ?fc_title}
WHERE { ?ds a <${t.spatial.datasetClass}> ;
      <${t.spatial.membershipRelationship}> ?fc ;
      <${t.props.dsLabel}> ?ds_title .
  ?fc <${t.props.fcLabel}> ?fc_title
      }`,Q=t=>({subject:t.subject.id,predicate:t.predicate.id,object:be(t.object)?t.object.value:t.object.id}),Pe=ae({id:"datasetsStore",state:()=>{const t=ie(z(se)),r=z(le);return{data:[],success:!1,store:new J,loading:!1,error:null,apiBaseUrl:r,mapConfig:t}},actions:{getMatchedData(t){const r=[],{subject:o=null,predicate:s=null,object:f=null}=t;for(const m of this.store.match(o,s,f))r.push(Q(m));return r},getDatasetTree(){const t=[];return this.getDatasets().forEach(r=>{t.push({item:r,featureCollections:this.getFeatureCollections([r.subject])})}),t},getDatasets(){let t=[];return this.getMatchedData({object:D(this.mapConfig.search.spatial.datasetClass)}).forEach(o=>{for(const s of this.store.match(D(o.subject),D(this.mapConfig.search.props.dsLabel)))t.push(Q(s))}),t},getFeatureCollections(t){if(t.length==0)return[];{let r=[];return t.forEach(o=>{this.getMatchedData({predicate:D(this.mapConfig.search.spatial.membershipRelationship),subject:D(o)}).forEach(f=>{for(const m of this.store.match(D(f.object),D(this.mapConfig.search.props.fcLabel)))r.push(Q(m))})}),r}},async fetchSpacePrezData(){return await this.fetchData(`${this.apiBaseUrl}/sparql`,Te(this.mapConfig.search))},async fetchData(t,r){try{const o=new me;this.loading=!0,this.success=!1;const s=await re.get(t,{params:{query:r}});this.data=o.parse(s.data),this.store=new J(this.data),this.success=!0,this.error=null}catch(o){this.error=o.message,this.success=!1}finally{this.loading=!1}}}}),xe={class:"button-container"},Fe=["onClick","disabled"],Ne=H({__name:"ButtonGroup",props:{buttons:{type:Array,required:!0},allowMultipleSelection:{type:Boolean,default:!1},initialValue:{type:String,default:null},disabled:{type:Boolean,default:!1}},emits:["change"],setup(t,{emit:r}){const o=t,s=p([]);function f(n){o.allowMultipleSelection?s.value.includes(n)?s.value=s.value.filter(v=>v!==n):s.value.push(n):s.value=[n],r("change",m.value)}const m=O(()=>s.value.map(n=>o.buttons[n].value));if(o.initialValue){const n=o.buttons.findIndex(y=>y.value===o.initialValue);n>=0&&s.value.push(n)}return ge(()=>o.initialValue,(n,y)=>{if(n=="")return;const v=o.buttons.findIndex(_=>_.value==n),C=v>=0?o.buttons[v]:"";if(n!==y||n!=C){const _=o.buttons.findIndex(M=>M.value===n);_>=0&&(s.value=[_])}}),(n,y)=>(c(),d("div",xe,[(c(!0),d($,null,A(t.buttons,(v,C)=>(c(),d("button",{key:C,onClick:_=>f(C),class:G(["btn sm",{outline:!s.value.includes(C)}]),disabled:o.disabled},E(v.text),11,Fe))),128))]))}});const Be=oe(Ne,[["__scopeId","data-v-274e2d88"]]),Le="/object?uri=",Ae=ae({id:"mapSearchStore",state:()=>{const t=z(le);return{data:[],success:!1,loading:!1,error:null,apiBaseUrl:t}},actions:{async searchMap(t){const r=`${this.apiBaseUrl}/sparql`;this.loading=!0,this.success=!1;try{const o=await re.get(r,{headers:{accept:"application/sparql-results+json"},params:{query:t}});this.data=o.data.results.bindings.filter(s=>s.fc_label?.value).map(s=>({uri:s.f_uri.value,link:`${Le}${s.f_uri.value}`,wkt:s.wkt.value,fcLabel:s.fc_label?.value,label:s.f_label.value})),this.success=!0,this.error=null}catch(o){this.error=o.message,this.data=[],this.success=!1}finally{this.loading=!1}}}}),b=t=>(Ce("data-v-db762008"),t=t(),Se(),t),ze={class:"spatial-search"},Ue={class:"search-options"},Ie={class:"search-form-container"},Ve={class:"search-form"},qe={class:"form-section"},Qe=b(()=>e("h4",null,"Map Selection",-1)),Oe={key:0,style:{"padding-top":"10px","font-size":"0.7em"}},Ge={class:"form-section"},He=b(()=>e("h4",null,"Datasets & Feature Collections",-1)),Ke={class:"dataset-buttons"},Xe={class:"select-all-input"},We=b(()=>e("label",{for:"select-all"},"Select all",-1)),Ye=b(()=>e("i",{class:"fa-regular fa-chevron-down"},null,-1)),Je=b(()=>e("i",{class:"fa-regular fa-chevron-up"},null,-1)),Ze={key:2,class:"dataset-options"},et={class:"dataset-option"},tt=["id","value","onChange"],at=["for"],st=["onClick"],lt={class:"fc-option"},ot=["id","value"],nt=["for"],it={class:"bottom-buttons"},rt=b(()=>e("i",{class:"fa-regular fa-code"},null,-1)),ct={class:"right-buttons"},ut={class:"result-limit-input"},dt=b(()=>e("label",{for:"result-limit"},"Result limit",-1)),pt=["disabled"],ht=b(()=>e("i",{class:"fa-regular fa-magnifying-glass"},null,-1)),ft={class:"search-map"},vt={class:"results"},mt=b(()=>e("h3",null,"Results",-1)),_t={key:2},bt=b(()=>e("thead",null,[e("tr",null,[e("th",null,"Title"),e("th",null,"Feature Collection")])],-1)),gt=["href"],yt={key:3},Ct={class:"sparql-query-content"},St=b(()=>e("i",{class:"fa-regular fa-copy"},null,-1)),wt=H({__name:"SpacePrezSearchMap",setup(t){const r=ie(z(se)),o=Pe(),s=Ae(),f=p([]),m=p([]),n=p([]),y=p(),v=p(R.None),C=p([]),_=p(k.Nearby),M=p(5),U=p(10);p(!1);const N=p(""),B=p(k.Nearby),S=p({}),I=p(null),K=p(),X=O(()=>Object.values(S.value).every(i=>i)),L=O(()=>{let i=!0;return f.value.forEach(a=>{if(m.value.includes(a.item.subject)){if(!a.featureCollections.every(l=>n.value.includes(l.subject)))return i=!1,!1}else return i=!1,!1}),i});function ce(){let i={};Object.keys(S.value).forEach(a=>i[a]=!X.value),S.value=i}async function ue(){let i=[],a=[];L.value||f.value.forEach(l=>{i.push(l.item.subject),a=[...a,...l.featureCollections.map(g=>g.subject)]}),m.value=i,n.value=a,await w()}const w=async()=>{N.value=De(n.value,C.value,_.value,M.value,U.value,r.search),await s.searchMap(N.value),s.success&&(K.value=s.data,y.value.drawShape(s.data))},de=async()=>{await o.fetchSpacePrezData(),o.success&&(f.value=o.getDatasetTree())};ne(async()=>{await de(),f.value.forEach(i=>{S.value[i.item.subject]=!0,m.value.push(i.item.subject),i.featureCollections.forEach(a=>{n.value.push(a.subject)})})});const pe=async(i,a)=>{v.value=a,C.value=i,a!=R.None&&(a==R.Point?(B.value=k.Nearby,_.value=k.Nearby):(B.value=k.Contains,_.value=k.Contains),await w())},he=je(k),fe=async i=>{B.value=i[0],_.value=i[0],await w()},ve=async(i,a)=>(a?i.featureCollections.forEach(l=>{n.value.includes(l.subject)||n.value.push(l.subject)}):i.featureCollections.forEach(l=>{const g=n.value.indexOf(l.subject);g>=0&&n.value.splice(g,1)}),await w(),!0);return(i,a)=>(c(),d($,null,[e("div",ze,[e("div",Ue,[e("div",Ie,[e("div",Ve,[e("div",qe,[Qe,x(Be,{"initial-value":v.value!=u(R).None?B.value:void 0,onChange:fe,buttons:u(he),allowMultipleSelection:!1,disabled:v.value==u(R).None},null,8,["initial-value","buttons","disabled"]),v.value!=u(R).None&&_.value==u(k).Nearby?(c(),d("div",Oe,[h(" within "),T(e("input",{type:"number",class:"radius-input","onUpdate:modelValue":a[0]||(a[0]=l=>M.value=l),onChange:a[1]||(a[1]=l=>w()),min:"1",max:"10000"},null,544),[[Z,M.value]]),h(" km ")])):V("",!0)]),e("div",Ge,[He,e("div",Ke,[e("div",Xe,[T(e("input",{type:"checkbox",name:"select-all",id:"select-all",onChange:ue,"onUpdate:modelValue":a[2]||(a[2]=l=>ye(L)?L.value=l:null)},null,544),[[q,u(L)]]),We]),e("button",{class:"btn outline sm",onClick:ce,title:"Toggle collapse all datasets"},[u(X)?(c(),d($,{key:0},[h("Expand all "),Ye],64)):(c(),d($,{key:1},[h("Collapse all "),Je],64))])]),u(o).loading?(c(),P(te,{key:0})):u(o).error?(c(),P(ee,{key:1,message:`Unable to load datasets: ${u(o).error}`},null,8,["message"])):(c(),d("ul",Ze,[(c(!0),d($,null,A(f.value,(l,g)=>(c(),d("li",et,[T(e("input",{type:"checkbox",id:`dataset-${g}`,value:l.item.subject,"onUpdate:modelValue":a[3]||(a[3]=j=>m.value=j),onChange:j=>ve(l,j.target?.checked)},null,40,tt),[[q,m.value]]),e("label",{for:`dataset-${g}`},E(l.item.object),9,at),e("button",{class:"btn outline sm dataset-collapse-btn",onClick:j=>S.value[l.item.subject]=!S.value[l.item.subject],title:"Toggle collapse this dataset"},[e("i",{class:G(`fa-regular fa-chevron-${S.value[l.item.subject]?"down":"up"}`)},null,2)],8,st),l.featureCollections.length>0?(c(),d("ul",{key:0,class:G(`fc-options ${S.value[l.item.subject]?"collapse":""}`)},[(c(!0),d($,null,A(l.featureCollections,(j,W)=>(c(),d("li",lt,[T(e("input",{type:"checkbox",id:`fc-${g}-${W}`,value:j.subject,"onUpdate:modelValue":a[4]||(a[4]=Y=>n.value=Y),onChange:a[5]||(a[5]=Y=>w())},null,40,ot),[[q,n.value]]),e("label",{for:`fc-${g}-${W}`},E(j.object),9,nt)]))),256))],2)):V("",!0)]))),256))]))])]),e("div",it,[e("button",{class:"btn outline",onClick:a[6]||(a[6]=l=>I.value="sparqlQuery")},[h("Show Query "),rt]),e("div",ct,[e("div",ut,[dt,T(e("input",{id:"result-limit",type:"number",onChange:a[7]||(a[7]=l=>w()),"onUpdate:modelValue":a[8]||(a[8]=l=>U.value=l),min:"1",max:"100"},null,544),[[Z,U.value]])]),e("button",{class:"btn",onClick:a[9]||(a[9]=l=>w()),disabled:v.value==u(R).None},[h("Search "),ht],8,pt)])])]),e("div",ft,[x(Re,{ref_key:"searchMapRef",ref:y,"geo-w-k-t":K.value,"drawing-modes":["MARKER","POLYGON","RECTANGLE"],onSelectionUpdated:pe},null,8,["geo-w-k-t"])])]),e("div",vt,[mt,u(s).loading?(c(),P(te,{key:0})):u(s).error?(c(),P(ee,{key:1,message:u(s).error},null,8,["message"])):u(s).data&&u(s).data.length>0?(c(),d("table",_t,[bt,e("tbody",null,[(c(!0),d($,null,A(u(s).data,l=>(c(),d("tr",null,[e("td",null,[e("a",{href:l.link},E(l.label),9,gt)]),e("td",null,E(l.fcLabel),1)]))),256))])])):(c(),d("div",yt," No results "))])]),I.value==="sparqlQuery"?(c(),P(Ee,{key:0,onModalClosed:a[11]||(a[11]=l=>I.value=null)},{headerMiddle:F(()=>[h("Spatial Search SPARQL Query")]),footer:F(()=>[e("button",{class:"btn outline sparql-copy-btn",onClick:a[10]||(a[10]=l=>u(Me)(N.value)),title:"Copy SPARQL query"},[h("Copy "),St])]),default:F(()=>[e("div",Ct,[e("pre",null,E(N.value.trim()),1)])]),_:1})):V("",!0)],64))}});const kt=oe(wt,[["__scopeId","data-v-db762008"]]),$t=e("h1",{class:"page-title"},"Spatial Data Catalog",-1),jt=e("a",{href:"https://www.w3.org/TR/vocab-dcat-2/"},"DCAT",-1),Rt=e("a",{href:"https://www.ogc.org/standard/geosparql/"},"GeoSPARQL",-1),xt=H({__name:"SpacePrezHomeView",setup(t){const r=we();return ne(()=>{r.rightNavConfig={enabled:!1},document.title="Spatial Data Catalog Home | Prez",r.pageHeading={name:"SpacePrez",url:"/s"},r.breadcrumbs=[{name:ke("SpacePrez")+" Home",url:"/s"}]}),(o,s)=>{const f=$e("RouterLink");return c(),d($,null,[$t,e("p",null,[h(" A spatial catalog of Feature Collections and Features conforming to "),jt,h(" and "),Rt,h(", and delivered as a read-only web system in both human and machine-readable views. The views are known as profiles and a list of them are available "),x(f,{to:"/s/profiles"},{default:F(()=>[h("here")]),_:1}),h(". ")]),e("p",null,[h(" The system provides a set of RDF APIs and also an OGC API for Feature Collections and Features. See the "),x(f,{to:"/docs"},{default:F(()=>[h("API Documentation")]),_:1}),h(" for more information. ")]),x(kt)],64)}}});export{xt as default};
