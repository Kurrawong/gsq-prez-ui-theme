import{a0 as Q,i as N,a1 as V,a2 as le,D as oe,a3 as ne,$ as H,B as K,d as z,x as h,k as ie,y as re,h as r,c,F as x,r as L,G as ce,t as b,_ as X,o as W,a as e,q as u,b as p,f as R,e as ue,z as P,E as G,C as M,m as T,p as de,j as pe,u as he,l as _e,w as O,N as fe}from"./index.818176dd.js";import{c as Y,S as $,A as w,e as ve,_ as me,m as be}from"./MapClient.vue_vue_type_script_setup_true_lang.73ee5935.js";import{a as J}from"./axios.98e08a26.js";const{namedNode:j}=oe,ge=t=>`PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX prez: <https://prez.dev/>

CONSTRUCT {?ds a <${t.spatial.datasetClass}> ;
    <${t.props.dsLabel}> ?ds_title ;
    <${t.spatial.membershipRelationship}> ?fc .
  ?fc a geo:FeatureCollection ;
  <${t.props.fcLabel}> ?fc_title}
WHERE { ?ds a <${t.spatial.datasetClass}> ;
      <${t.spatial.membershipRelationship}> ?fc ;
      <${t.props.dsLabel}> ?ds_title .
  ?fc <${t.props.fcLabel}> ?fc_title
      }`,U=t=>({subject:t.subject.id,predicate:t.predicate.id,object:ne(t.object)?t.object.value:t.object.id}),ye=Q({id:"datasetsStore",state:()=>{const t=Y(N(H)),i=N(K);return{data:[],success:!1,store:new V,loading:!1,error:null,apiBaseUrl:i,mapConfig:t}},actions:{getMatchedData(t){const i=[],{subject:a=null,predicate:s=null,object:f=null}=t;for(const g of this.store.match(a,s,f))i.push(U(g));return i},getDatasetTree(){const t=[];return this.getDatasets().forEach(i=>{t.push({item:i,featureCollections:this.getFeatureCollections([i.subject])})}),t},getDatasets(){let t=[];return this.getMatchedData({object:j(this.mapConfig.search.spatial.datasetClass)}).forEach(a=>{for(const s of this.store.match(j(a.subject),j(this.mapConfig.search.props.dsLabel)))t.push(U(s))}),t},getFeatureCollections(t){if(t.length==0)return[];{let i=[];return t.forEach(a=>{this.getMatchedData({predicate:j(this.mapConfig.search.spatial.membershipRelationship),subject:j(a)}).forEach(f=>{for(const g of this.store.match(j(f.object),j(this.mapConfig.search.props.fcLabel)))i.push(U(g))})}),i}},async fetchSpacePrezData(){return await this.fetchData(`${this.apiBaseUrl}/s/sparql`,ge(this.mapConfig.search))},async fetchData(t,i){try{const a=new le;this.loading=!0,this.success=!1;const s=await J.get(t,{params:{query:i}});this.data=a.parse(s.data),this.store=new V(this.data),this.success=!0,this.error=null}catch(a){this.error=a.message,this.success=!1}finally{this.loading=!1}}}}),Ce={class:"button-container"},Se=["onClick"],we=z({__name:"ButtonGroup",props:{buttons:{type:Array,required:!0},allowMultipleSelection:{type:Boolean,default:!1},initialValue:{type:String,default:null}},emits:["change"],setup(t,{emit:i}){const a=t,s=h([]);function f(o){a.allowMultipleSelection?s.value.includes(o)?s.value=s.value.filter(_=>_!==o):s.value.push(o):s.value=[o],i("change",g.value)}const g=ie(()=>s.value.map(o=>a.buttons[o].value));if(a.initialValue){const o=a.buttons.findIndex(C=>C.value===a.initialValue);o>=0&&s.value.push(o)}return re(()=>a.initialValue,(o,C)=>{if(o=="")return;const _=a.buttons.findIndex(v=>v.value==o),S=_>=0?a.buttons[_]:"";if(o!==C||o!=S){const v=a.buttons.findIndex(D=>D.value===o);v>=0&&(s.value=[v])}}),(o,C)=>(r(),c("div",Ce,[(r(!0),c(x,null,L(t.buttons,(_,S)=>(r(),c("div",{key:S,onClick:v=>f(S),class:ce(["btn sm",{outline:!s.value.includes(S)}])},b(_.text),11,Se))),128))]))}});const ke=X(we,[["__scopeId","data-v-4a481689"]]),Re="/object?uri=",$e=Q({id:"mapSearchStore",state:()=>{const t=N(K);return{data:[],success:!1,loading:!1,error:null,apiBaseUrl:t}},actions:{async searchMap(t){const i=`${this.apiBaseUrl}/s/sparql`;this.loading=!0,this.success=!1;try{const a=await J.get(i,{headers:{accept:"application/sparql-results+json"},params:{query:t}});this.data=a.data.results.bindings.filter(s=>s.fc_label?.value).map(s=>({uri:s.f_uri.value,link:`${Re}${s.f_uri.value}`,wkt:s.wkt.value,fcLabel:s.fc_label?.value,label:s.f_label.value})),this.success=!0,this.error=null}catch(a){this.error=a.message,this.data=[],this.success=!1}finally{this.loading=!1}}}}),d=t=>(de("data-v-445947d4"),t=t(),pe(),t),je={class:"container"},xe={class:"left-panel"},De={action:"",class:"query-options"},Pe={class:"query-option"},Fe=d(()=>e("h4",{class:"query-option-title"},"Search map selection",-1)),Le={class:"msg"},Te=d(()=>e("i",{class:"fa-solid fa-play"},null,-1)),Ne=d(()=>e("p",null,null,-1)),Be={key:0},Ee=d(()=>e("p",null,null,-1)),Ie={key:2,style:{"padding-top":"10px","font-size":"0.7em"}},Me=d(()=>e("p",null,null,-1)),Ue={class:"query-option"},ze=d(()=>e("h4",{class:"query-option-title"},"Find features and datasets",-1)),Ae={key:0},qe=d(()=>e("h4",null,"Loading...",-1)),Ve=d(()=>e("div",{class:"loading-icon"},null,-1)),Ge=[qe,Ve],Oe={key:1,class:"error"},Qe=["value","onChange"],He={key:0},Ke=["value"],Xe=d(()=>e("p",null,null,-1)),We={class:"nowrap"},Ye={class:"nowrap"},Je={class:"space-right"},Ze=["disabled"],et={class:"right-panel"},tt={key:0},st=d(()=>e("h3",null,"Loading...",-1)),at=d(()=>e("div",{class:"loading-icon"},null,-1)),lt=[st,at],ot={key:1},nt={key:0},it=d(()=>e("h3",null,"Result set",-1)),rt=d(()=>e("thead",null,[e("th",null,"Feature collection"),e("th",null,"Label"),e("th",null,"URI")],-1)),ct=["href"],ut={key:1},dt=d(()=>e("h3",null,"Unable to search map",-1)),pt={class:"error"},ht={key:2},_t=d(()=>e("h3",null,"No results",-1)),ft=[_t],vt={key:0,class:"debug"},mt=d(()=>e("b",null,"SPARQL query:",-1)),bt=z({__name:"SpacePrezSearchMap",setup(t){const i=Y(N(H)),a=ye(),s=$e(),f=h([]),g=h([]),o=h([]),C=h(),_=h($.None),S=h([]),v=h(w.Nearby),D=h(5),B=h(10),E=h(!1),I=h(""),F=h(w.Nearby),A=h(),k=async()=>{I.value=be(o.value,S.value,v.value,D.value,B.value,i.search),await s.searchMap(I.value),s.success&&(A.value=s.data,C.value.drawShape(s.data))},Z=async()=>{await a.fetchSpacePrezData(),a.success&&(f.value=a.getDatasetTree())};W(async()=>{await Z(),f.value.forEach(m=>{g.value.push(m.item.subject),m.featureCollections.forEach(l=>{o.value.push(l.subject)})})});const ee=async(m,l)=>{_.value=l,S.value=m,l!=$.None&&(l==$.Point?(F.value=w.Nearby,v.value=w.Nearby):(F.value=w.Contains,v.value=w.Contains),await k())},te=ve(w),se=async m=>{F.value=m[0],v.value=m[0],await k()},ae=async(m,l)=>(l?m.featureCollections.forEach(n=>{o.value.includes(n.subject)||o.value.push(n.subject)}):m.featureCollections.forEach(n=>{const y=o.value.indexOf(n.subject);y>=0&&o.value.splice(y,1)}),await k(),!0);return(m,l)=>(r(),c(x,null,[e("div",je,[e("div",xe,[e("form",De,[e("div",Pe,[Fe,e("div",Le,[Te,u(" "+b(_.value),1)]),Ne,_.value==p($).None?(r(),c("div",Be,"Select a point or rectangle on the map to begin")):R("",!0),Ee,_.value!=p($).None?(r(),ue(ke,{key:1,"initial-value":F.value,onChange:se,buttons:p(te),allowMultipleSelection:!1},null,8,["initial-value","buttons"])):R("",!0),_.value!=p($).None&&v.value==p(w).Nearby?(r(),c("div",Ie,[u(" within "),P(e("input",{class:"small-input","onUpdate:modelValue":l[0]||(l[0]=n=>D.value=n),onChange:l[1]||(l[1]=n=>k())},null,544),[[G,D.value]]),u(" km ")])):R("",!0),Me]),e("div",Ue,[ze,p(a).loading?(r(),c("div",Ae,Ge)):p(a).error?(r(),c("div",Oe,"Unable to load datasets: "+b(p(a).error),1)):R("",!0),(r(!0),c(x,null,L(f.value,n=>(r(),c("div",null,[e("ul",null,[e("li",null,[e("label",null,[P(e("input",{type:"checkbox",value:n.item.subject,"onUpdate:modelValue":l[2]||(l[2]=y=>g.value=y),onChange:y=>ae(n,y.target?.checked)},null,40,Qe),[[M,g.value]]),u(" "+b(n.item.object),1)]),n.featureCollections.length>0?(r(),c("ul",He,[(r(!0),c(x,null,L(n.featureCollections,y=>(r(),c("li",null,[e("label",null,[P(e("input",{type:"checkbox",value:y.subject,"onUpdate:modelValue":l[3]||(l[3]=q=>o.value=q),onChange:l[4]||(l[4]=q=>k())},null,40,Ke),[[M,o.value]]),u(b(y.object),1)])]))),256))])):R("",!0)])])]))),256))]),Xe,e("span",We,[u("Results limit: "),P(e("input",{id:"input-limit",class:"space-right",onChange:l[5]||(l[5]=n=>k()),"onUpdate:modelValue":l[6]||(l[6]=n=>B.value=n)},null,544),[[G,B.value]])]),e("span",Ye,[e("label",Je,[P(e("input",{"onUpdate:modelValue":l[7]||(l[7]=n=>E.value=n),type:"checkbox"},null,512),[[M,E.value]]),u("Show query")])]),e("button",{onClick:l[8]||(l[8]=n=>k()),disabled:_.value==p($).None,class:"btn",type:"button"},"Search",8,Ze)])]),e("div",et,[T(me,{ref_key:"searchMapRef",ref:C,"geo-w-k-t":A.value,"drawing-modes":["MARKER","POLYGON","RECTANGLE"],onSelectionUpdated:ee},null,8,["geo-w-k-t"]),p(s).loading?(r(),c("div",tt,lt)):(r(),c("div",ot,[p(s).data&&p(s).data.length>0?(r(),c("div",nt,[it,e("table",null,[rt,e("tbody",null,[(r(!0),c(x,null,L(p(s).data,n=>(r(),c("tr",null,[e("td",null,b(n.fcLabel),1),e("td",null,b(n.label),1),e("td",null,[e("a",{href:`${n.link}`},b(n.uri),9,ct)])]))),256))])])])):p(s).error?(r(),c("div",ut,[dt,e("div",pt,b(p(s).error),1)])):(r(),c("div",ht,ft))]))])]),E.value?(r(),c("pre",vt,[u(`
`),mt,u(`

`+b(I.value)+`

`,1),R("",!0),u(`

`)])):R("",!0)],64))}});const gt=X(bt,[["__scopeId","data-v-445947d4"]]),yt=e("h1",null,"Spatial Data Catalog",-1),Ct=e("a",{href:"https://www.w3.org/TR/vocab-dcat-2/"},"DCAT",-1),St=e("a",{href:"https://www.ogc.org/standard/geosparql/"},"GeoSPARQL",-1),$t=z({__name:"SpacePrezHomeView",setup(t){const i=he();return W(()=>{i.rightNavConfig={enabled:!1},document.title="Spatial Data Catalog Home | Prez",i.pageHeading={name:"SpacePrez",url:"/s"},i.breadcrumbs=[{name:_e("SpacePrez")+" Home",url:"/s"}]}),(a,s)=>{const f=fe("RouterLink");return r(),c(x,null,[yt,e("p",null,[u(" A spatial catalog of Feature Collections and Features conforming to "),Ct,u(" and "),St,u(", and delivered as a read-only web system in both human and machine-readable views. The views are known as profiles and a list of them are available "),T(f,{to:"/s/profiles"},{default:O(()=>[u("here")]),_:1}),u(". ")]),e("p",null,[u(" The system provides a set of RDF APIs and also an OGC API for Feature Collections and Features. See the "),T(f,{to:"/docs"},{default:O(()=>[u("API Documentation")]),_:1}),u(" for more information. ")]),T(gt)],64)}}});export{$t as default};
