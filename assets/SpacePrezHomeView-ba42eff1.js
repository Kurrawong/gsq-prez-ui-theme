import{d as Z,x as h,k as Q,y as A,h as n,c as i,F as $,r as H,Z as J,t as q,_ as ce,i as le,M as we,aa as ke,E as Ce,ab as Se,ac as $e,G as Ee,o as de,J as Re,a,m as B,b as _,q as c,z as j,ad as se,f as Y,e as x,ae as oe,w as G,a2 as Le,O as ne,V as ie,p as Ie,j as Ne,W as Te,u as Ae,l as Fe,a4 as Pe}from"./index-e24ad5b5.js";import{A as y,e as Ve,S as T,_ as qe}from"./MapClient.vue_vue_type_script_setup_true_lang-117be11d.js";import{E as ue,L as re}from"./LoadingMessage-4a291b17.js";import{B as Oe}from"./BaseModal-f6fc370c.js";function De(b,u,d,f,w,k){let s;if(u.length==0)s="";else if(u.length==1){const r=u[0];s=`POINT (${r[0]} ${r[1]})`}else s=`POLYGON ((${u.map(r=>`${r[0]} ${r[1]}`).join(", ")}))`;let v="";switch(d){case y.Contains:v=`FILTER (geof:sfContains("${s}"^^geo:wktLiteral, ?wkt))`;break;case y.Within:v=`FILTER (geof:sfWithin("${s}"^^geo:wktLiteral, ?wkt))`;break;case y.Nearby:v=`FILTER (spatialF:nearby("${s}"^^geo:wktLiteral, ?wkt, ${f}, unit:kilometre))`;break;case y.Overlaps:v=`FILTER (geof:sfOverlaps("${s}"^^geo:wktLiteral, ?wkt))`;break;default:v=""}return`PREFIX geo: <http://www.opengis.net/ont/geosparql#>
    PREFIX geof: <http://www.opengis.net/def/function/geosparql/>
    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
    PREFIX spatialF: <http://jena.apache.org/function/spatial#>
    PREFIX unit: <http://www.opengis.net/def/uom/OGC/1.0/>
    SELECT ?f_uri ?wkt ?fc ?fc_label ?f_label
    WHERE {
        ?f_uri geo:hasGeometry/geo:asWKT ?wkt .
        
        ${b.map(r=>`{
                <${r}> rdfs:member ?f_uri ;
                    <${k.props.fcLabel}> ?fc_label .
                BIND (<${r}> AS ?fc)
            }`).join(" UNION ")}

        OPTIONAL {
            ?f_uri <${k.props.fLabel}> ?f_label .
        }

        ${v}
    }
    LIMIT ${w}`}const Me={class:"button-container"},xe=["onClick","disabled"],Be=Z({__name:"ButtonGroup",props:{buttons:{type:Array,required:!0},allowMultipleSelection:{type:Boolean,default:!1},initialValue:{type:String,default:null},disabled:{type:Boolean,default:!1}},emits:["change"],setup(b,{emit:u}){const d=b,f=h([]);function w(s){d.allowMultipleSelection?f.value.includes(s)?f.value=f.value.filter(r=>r!==s):f.value.push(s):f.value=[s],u("change",k.value)}const k=Q(()=>f.value.map(s=>d.buttons[s].value));if(d.initialValue){const s=d.buttons.findIndex(v=>v.value===d.initialValue);s>=0&&f.value.push(s)}return A(()=>d.initialValue,(s,v)=>{if(s=="")return;const r=d.buttons.findIndex(R=>R.value==s),E=r>=0?d.buttons[r]:"";if(s!==v||s!=E){const R=d.buttons.findIndex(O=>O.value===s);R>=0&&(f.value=[R])}}),(s,v)=>(n(),i("div",Me,[(n(!0),i($,null,H(b.buttons,(r,E)=>(n(),i("button",{key:E,onClick:R=>w(E),class:J(["btn sm",{outline:!f.value.includes(E)}]),disabled:d.disabled},q(r.text),11,xe))),128))]))}});const Ge=ce(Be,[["__scopeId","data-v-274e2d88"]]),g=b=>(Ie("data-v-d2ef0615"),b=b(),Ne(),b),ze={class:"spatial-search"},Ue={class:"search-options"},je={class:"search-form-container"},Qe={class:"search-form"},He={class:"form-section"},We=g(()=>a("h4",null,"Map Selection",-1)),Xe={key:0,style:{"padding-top":"10px","font-size":"0.7em"}},Ke={class:"form-section"},Ye=g(()=>a("h4",null,"Datasets & Feature Collections",-1)),Je={class:"dataset-buttons"},Ze={class:"select-all-input"},ea=["checked"],aa=g(()=>a("label",{for:"select-all"},"Select all",-1)),ta=g(()=>a("i",{class:"fa-regular fa-chevron-down"},null,-1)),la=g(()=>a("i",{class:"fa-regular fa-chevron-up"},null,-1)),sa={key:2,class:"dataset-options"},oa={class:"dataset-option"},na=["id","value","onChange"],ia=["for"],ua=["onClick"],ra={class:"fc-option"},ca=["id","value"],da=["for"],pa={class:"bottom-buttons"},fa=g(()=>a("i",{class:"fa-regular fa-code"},null,-1)),va={class:"right-buttons"},_a={class:"result-limit-input"},ha=g(()=>a("label",{for:"result-limit"},"Result limit",-1)),ma=["disabled"],ga=g(()=>a("i",{class:"fa-regular fa-magnifying-glass"},null,-1)),ba={class:"search-map"},ya={class:"results"},wa=g(()=>a("h3",null,"Results",-1)),ka={key:2},Ca=g(()=>a("thead",null,[a("tr",null,[a("th",null,"Title"),a("th",null,"Feature Collection")])],-1)),Sa=["href"],$a={key:3},Ea={class:"sparql-query-content"},Ra=g(()=>a("i",{class:"fa-regular fa-copy"},null,-1)),La=Z({__name:"SpacePrezSearchMap",setup(b){const{namedNode:u}=Te,d=le(we),f=le(ke),{loading:w,error:k,apiGetRequest:s}=Ce(),{loading:v,hasError:r,concurrentApiRequests:E}=Se(),{loading:R,error:O,sparqlGetRequest:pe}=$e(),{store:F,parseIntoStore:ee,qnameToIri:P}=Ee(),fe=Ve(y),D=h([]),V=h([]),m=h([]),C=h({type:T.None,coords:[]}),L=h(y.Nearby),W=h(!1),z=h(10),U=h(5),M=h([]),S=h({}),X=h(null),ae=Q(()=>Object.values(S.value).every(t=>t)),te=Q(()=>{let t=!0;return D.value.forEach(e=>{if(V.value.includes(e.iri)){if(!e.featureCollections.every(l=>m.value.includes(l.iri)))return t=!1,!1}else return t=!1,!1}),t}),K=Q(()=>De(m.value,C.value.coords,L.value,U.value,z.value,f.search));function ve(){let t=[],e=[];te.value||D.value.forEach(l=>{t.push(l.iri),e=[...e,...l.featureCollections.map(o=>o.iri)]}),V.value=t,m.value=e}function _e(t,e){e?t.featureCollections.forEach(l=>{m.value.includes(l.iri)||m.value.push(l.iri)}):t.featureCollections.forEach(l=>{const o=m.value.indexOf(l.iri);o>=0&&m.value.splice(o,1)})}function he(){let t={};Object.keys(S.value).forEach(e=>t[e]=!ae.value),S.value=t}function me(t){L.value=t[0]}function ge(t,e){C.value={type:e,coords:t},e!=T.None&&(e==T.Point?L.value=y.Nearby:L.value=y.Contains)}async function be(){const{data:t}=await s("/s/datasets");if(t&&!k.value){ee(t);const e={};F.value.forSubjects(o=>{const p={iri:o.value,link:"",featureCollections:[]};p.title=ne(o.value,F.value),F.value.forObjects(N=>{p.link=N.value},o,u(P("prez:link")),null),e[o.value]=p},u(P("a")),u(P("dcat:Dataset")),null),(await E(Object.values(e).map(o=>`${o.link}/collections`))).forEach(o=>{o.value&&ee(o.value)}),F.value.forSubjects(o=>{F.value.forObjects(p=>{const N={iri:p.value};N.title=ne(p.value,F.value),e[o.value].featureCollections.push(N)},o,u(P("rdfs:member")),null),e[o.value].featureCollections.sort(ie)},u(P("a")),u(P("dcat:Dataset")),null),D.value=Object.values(e).sort(ie)}}async function I(){if(C.value.coords.length>0){const t=await pe(`${d}/sparql`,K.value);t&&!O.value&&(M.value=t.results.bindings.map(e=>({uri:e.f_uri.value,link:`/object?uri=${encodeURIComponent(e.f_uri.value)}`,wkt:e.wkt.value,fcLabel:e.fc_label?e.fc_label.value:"",label:e.f_label?e.f_label.value:""})),X.value&&X.value.drawShape(M.value))}}return A(V,async(t,e)=>{await I()},{deep:!0}),A(m,async(t,e)=>{await I()},{deep:!0}),A(z,async(t,e)=>{await I()}),A(U,async(t,e)=>{await I()}),A(C,async(t,e)=>{await I()},{deep:!0}),A(L,async(t,e)=>{await I()}),de(async()=>{await Re(),await be(),D.value.forEach(t=>{S.value[t.iri]=!0,V.value.push(t.iri),t.featureCollections.forEach(e=>{m.value.push(e.iri)})})}),(t,e)=>(n(),i($,null,[a("div",ze,[a("div",Ue,[a("div",je,[a("div",Qe,[a("div",He,[We,B(Ge,{"initial-value":C.value.type!==_(T).None?L.value:void 0,onChange:me,buttons:_(fe),allowMultipleSelection:!1,disabled:C.value.type===_(T).None},null,8,["initial-value","buttons","disabled"]),C.value.type!==_(T).None&&L.value==_(y).Nearby?(n(),i("div",Xe,[c(" within "),j(a("input",{type:"number",class:"radius-input","onUpdate:modelValue":e[0]||(e[0]=l=>U.value=l),min:"1",max:"10000"},null,512),[[se,U.value]]),c(" km ")])):Y("",!0)]),a("div",Ke,[Ye,a("div",Je,[a("div",Ze,[a("input",{type:"checkbox",name:"select-all",id:"select-all",onChange:ve,checked:te.value},null,40,ea),aa]),a("button",{class:"btn outline sm",onClick:he,title:"Toggle collapse all datasets"},[ae.value?(n(),i($,{key:0},[c("Expand all "),ta],64)):(n(),i($,{key:1},[c("Collapse all "),la],64))])]),_(w)||_(v)?(n(),x(re,{key:0})):_(k)?(n(),x(ue,{key:1,message:`Unable to load datasets: ${_(k)}`},null,8,["message"])):(n(),i("ul",sa,[(n(!0),i($,null,H(D.value,(l,o)=>(n(),i("li",oa,[j(a("input",{type:"checkbox",id:`dataset-${o}`,value:l.iri,"onUpdate:modelValue":e[1]||(e[1]=p=>V.value=p),onChange:p=>_e(l,p.target?.checked)},null,40,na),[[oe,V.value]]),a("label",{for:`dataset-${o}`},q(l.title||l.iri),9,ia),a("button",{class:"btn outline sm dataset-collapse-btn",onClick:p=>S.value[l.iri]=!S.value[l.iri],title:"Toggle collapse this dataset"},[a("i",{class:J(`fa-regular fa-chevron-${S.value[l.iri]?"down":"up"}`)},null,2)],8,ua),l.featureCollections.length>0?(n(),i("ul",{key:0,class:J(`fc-options ${S.value[l.iri]?"collapse":""}`)},[(n(!0),i($,null,H(l.featureCollections,(p,N)=>(n(),i("li",ra,[j(a("input",{type:"checkbox",id:`fc-${o}-${N}`,value:p.iri,"onUpdate:modelValue":e[2]||(e[2]=ye=>m.value=ye)},null,8,ca),[[oe,m.value]]),a("label",{for:`fc-${o}-${N}`},q(p.title||p.iri),9,da)]))),256))],2)):Y("",!0)]))),256))]))])]),a("div",pa,[a("button",{class:"btn outline",onClick:e[3]||(e[3]=l=>W.value=!0)},[c("Show Query "),fa]),a("div",va,[a("div",_a,[ha,j(a("input",{id:"result-limit",type:"number","onUpdate:modelValue":e[4]||(e[4]=l=>z.value=l),min:"1",max:"100"},null,512),[[se,z.value]])]),a("button",{class:"btn",onClick:e[5]||(e[5]=l=>I()),disabled:C.value.type==_(T).None},[c("Search "),ga],8,ma)])])]),a("div",ba,[B(qe,{ref_key:"searchMap",ref:X,"geo-w-k-t":M.value,"drawing-modes":["MARKER","POLYGON","RECTANGLE"],onSelectionUpdated:ge},null,8,["geo-w-k-t"])])]),a("div",ya,[wa,_(R)?(n(),x(re,{key:0})):_(O)?(n(),x(ue,{key:1,message:_(O)},null,8,["message"])):M.value.length>0?(n(),i("table",ka,[Ca,a("tbody",null,[(n(!0),i($,null,H(M.value,l=>(n(),i("tr",null,[a("td",null,[a("a",{href:l.link},q(l.label||l.uri),9,Sa)]),a("td",null,q(l.fcLabel),1)]))),256))])])):(n(),i("div",$a," No results "))])]),W.value?(n(),x(Oe,{key:0,onModalClosed:e[7]||(e[7]=l=>W.value=!1)},{headerMiddle:G(()=>[c("Spatial Search SPARQL Query")]),footer:G(()=>[a("button",{class:"btn outline sparql-copy-btn",onClick:e[6]||(e[6]=l=>_(Le)(K.value)),title:"Copy SPARQL query"},[c("Copy "),Ra])]),default:G(()=>[a("div",Ea,[a("pre",null,q(K.value.trim()),1)])]),_:1})):Y("",!0)],64))}});const Ia=ce(La,[["__scopeId","data-v-d2ef0615"]]),Na=a("h1",{class:"page-title"},"Spatial Data Catalog",-1),Ta=a("a",{href:"https://www.w3.org/TR/vocab-dcat-2/"},"DCAT",-1),Aa=a("a",{href:"https://www.ogc.org/standard/geosparql/"},"GeoSPARQL",-1),Oa=Z({__name:"SpacePrezHomeView",setup(b){const u=Ae();return de(()=>{u.rightNavConfig={enabled:!1},document.title="Spatial Data Catalog Home | Prez",u.pageHeading={name:"SpacePrez",url:"/s"},u.breadcrumbs=[{name:Fe("SpacePrez")+" Home",url:"/s"}]}),(d,f)=>{const w=Pe("RouterLink");return n(),i($,null,[Na,a("p",null,[c(" A spatial catalog of Feature Collections and Features conforming to "),Ta,c(" and "),Aa,c(", and delivered as a read-only web system in both human and machine-readable views. The views are known as profiles and a list of them are available "),B(w,{to:"/s/profiles"},{default:G(()=>[c("here")]),_:1}),c(". ")]),a("p",null,[c(" The system provides a set of RDF APIs and also an OGC API for Feature Collections and Features. See the "),B(w,{to:"/docs"},{default:G(()=>[c("API Documentation")]),_:1}),c(" for more information. ")]),B(Ia)],64)}}});export{Oa as default};
